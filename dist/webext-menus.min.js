var webextMenus=function(){"use strict";function e(e){const n=new Map,t=new Map,i=function(e){const n=new Set(["all","bookmark","browser_action","launcher","page_action","tab","tools_menu"]);return Object.values(e.ContextType).filter(e=>!n.has(e))}(e);return{create:function(o,s){const r=e.create(Object.assign({},o),s),c={id:r,rawOptions:o,visible:!0,pendingVisible:null,prev:[],refreshed:!1};n.set(r,c);for(const e of(l=function e(t){return t.rawOptions.contexts?t.rawOptions.contexts:null!=t.rawOptions.parentId?e(n.get(t.rawOptions.parentId)):["page"]}(c),l.reduce((e,n)=>("all"===n?i.forEach(n=>e.add(n)):e.add(n),e),new Set))){const n=`${o.parentId}/${e}`,i=t.get(n);i&&c.prev.push(i),t.set(n,c)}var l;return r},update:function(t,i){const o=n.get(t);null!=i.visible&&(i.visible!==o.visible&&(o.pendingVisible=i.visible),delete i.visible);if(Object.assign(o.rawOptions,i),o.visible)return e.update(t,i)},commit:function(){for(const t of n.values())t.prev.some(e=>e.refreshed)&&(t.refreshed=!0,null==t.pendingVisible&&t.visible&&(e.remove(t.id),t.pendingVisible=!0)),!1===t.pendingVisible?(e.remove(t.id),t.visible=!1,t.pendingVisible=null):!0===t.pendingVisible&&(e.create(t.rawOptions),t.visible=!0,t.pendingVisible=null,t.refreshed=!0);for(const e of n.values())e.refreshed=!1}}}return function(n,t){const i=function(){const e="undefined"!=typeof browser?browser:chrome;return e.menus||e.contextMenus}(),o=[],s=[],r=(null==t?function(e){let n;try{return n=e.create({visible:!1},()=>{const e="undefined"!=typeof browser?browser:chrome;e.runtime.lastError&&console.warn("failed to create menu when checking visible property",e.runtime.lastError)}),!0}catch(e){return!1}finally{null!=n&&e.remove(n)}}(i):t)?i:e(i);return function(){for(const e of n)e.options=Object.assign({},e),"function"==typeof e.checked&&(delete e.options.checked,s.push(e)),e.oncontext?(delete e.options.oncontext,o.push(e),e.show=!1,e.options.visible=!1):e.show=!0,e.id=e.options.id=r.create(Object.assign({},e.options))}(),{update:function(){(function(){for(const e of o){const n=Boolean(e.oncontext());e.show!==n&&(e.show=n,e.options.visible=n,r.update(e.id,{visible:n}))}r.commit&&r.commit()})(),function(){for(const e of s)r.update(e.id,{checked:e.checked()})}()}}}}();
//# sourceMappingURL=webext-menus.min.js.map
